<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ù„Ø³Ø§Øª - Ù†Ø¸Ø§Ù… Ø¹Ø¯Ø§Ù„Ø©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
        .sessions-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
        }

        .filters-section {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr auto;
            gap: 1rem;
            align-items: end;
        }

        .sessions-table {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background: #f8f9fa;
            padding: 1rem;
            text-align: right;
            font-weight: 600;
            border-bottom: 2px solid #dee2e6;
        }

        .table td {
            padding: 1rem;
            border-bottom: 1px solid #dee2e6;
        }

        .table tbody tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-scheduled { background: #d1ecf1; color: #0c5460; }
        .status-held { background: #d4edda; color: #155724; }
        .status-cancelled { background: #f8d7da; color: #721c24; }
        .status-postponed { background: #fff3cd; color: #856404; }

        .type-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            background: #e9ecef;
            color: #495057;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .btn-icon {
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-icon:hover {
            transform: translateY(-2px);
        }

        .btn-view { background: #17a2b8; color: white; }
        .btn-edit { background: #ffc107; color: white; }
        .btn-delete { background: #dc3545; color: white; }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 0;
            border-radius: 15px;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid #dee2e6;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .upcoming-badge {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .alert-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        .alert-info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .loading-spinner {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            text-align: center;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @media (max-width: 768px) {
            .filter-grid {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin fa-2x" style="color: #667eea; margin-bottom: 1rem;"></i>
            <div id="loadingText">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
        </div>
    </div>

    <nav class="navbar">
        <div class="navbar-container">
            <div class="navbar-brand">
                <i class="fas fa-gavel"></i>
                Ù†Ø¸Ø§Ù… Ø¹Ø¯Ø§Ù„Ø©
            </div>
            
            <ul class="navbar-nav">
                <li><a href="/dashboard" class="nav-link"><i class="fas fa-tachometer-alt"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a></li>
                <li><a href="/cases" class="nav-link"><i class="fas fa-gavel"></i> Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§</a></li>
                <li><a href="/sessions" class="nav-link active"><i class="fas fa-calendar-alt"></i> Ø§Ù„Ø¬Ù„Ø³Ø§Øª</a></li>
                <li><a href="/clients" class="nav-link"><i class="fas fa-users"></i> Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</a></li>
                <li>
                    <button class="btn btn-danger btn-sm" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Ø®Ø±ÙˆØ¬
                    </button>
                </li>
            </ul>
        </div>
    </nav>

    <div class="main-container">
        <!-- Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© -->
        <div class="sessions-header">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h1><i class="fas fa-calendar-alt"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ù„Ø³Ø§Øª</h1>
                    <p>Ø¬Ø¯ÙˆÙ„Ø© ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù‚Ø¶Ø§Ø¦ÙŠØ©</p>
                </div>
                <button class="btn btn-light btn-lg" onclick="openAddModal()">
                    <i class="fas fa-plus"></i> Ø¬Ø¯ÙˆÙ„Ø© Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©
                </button>
            </div>
        </div>

        <!-- Ø§Ù„ÙÙ„Ø§ØªØ± ÙˆØ§Ù„Ø¨Ø­Ø« -->
        <div class="filters-section">
            <div class="filter-grid">
                <div>
                    <label for="searchInput" class="form-label">Ø¨Ø­Ø«</label>
                    <input type="text" id="searchInput" class="form-control" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¬Ù„Ø³Ø§Øª...">
                </div>
                <div>
                    <label for="caseFilter" class="form-label">Ø§Ù„Ù‚Ø¶ÙŠØ©</label>
                    <select id="caseFilter" class="form-control">
                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§</option>
                    </select>
                </div>
                <div>
                    <label for="statusFilter" class="form-label">Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ù„Ø³Ø©</label>
                    <select id="statusFilter" class="form-control">
                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                        <option value="Ù…Ø¬Ø¯ÙˆÙ„">Ù…Ø¬Ø¯ÙˆÙ„</option>
                        <option value="Ù…Ù†Ø¹Ù‚Ø¯">Ù…Ù†Ø¹Ù‚Ø¯</option>
                        <option value="Ù…Ù„ØºÙŠ">Ù…Ù„ØºÙŠ</option>
                        <option value="Ù…Ø¤Ø¬Ù„">Ù…Ø¤Ø¬Ù„</option>
                    </select>
                </div>
                <div>
                    <label for="typeFilter" class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù„Ø³Ø©</label>
                    <select id="typeFilter" class="form-control">
                        <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                        <option value="Ø§Ø³ØªÙ…Ø§Ø¹">Ø§Ø³ØªÙ…Ø§Ø¹</option>
                        <option value="Ù†Ø¸Ø±">Ù†Ø¸Ø±</option>
                        <option value="ØªØ­ÙƒÙŠÙ…">ØªØ­ÙƒÙŠÙ…</option>
                        <option value="Ø¥Ø«Ø¨Ø§Øª">Ø¥Ø«Ø¨Ø§Øª</option>
                        <option value="Ø­ÙƒÙ…">Ø­ÙƒÙ…</option>
                    </select>
                </div>
                <div>
                    <button class="btn btn-primary" onclick="loadSessions()">
                        <i class="fas fa-search"></i> Ø¨Ø­Ø«
                    </button>
                    <button class="btn btn-outline-primary" onclick="showUpcomingOnly()">
                        <i class="fas fa-clock"></i> Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© ÙÙ‚Ø·
                    </button>
                </div>
            </div>
        </div>

        <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¬Ù„Ø³Ø§Øª -->
        <div class="sessions-table">
            <table class="table">
                <thead>
                    <tr>
                        <th>Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„Ø³Ø©</th>
                        <th>Ø§Ù„Ù‚Ø¶ÙŠØ©</th>
                        <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¬Ù„Ø³Ø©</th>
                        <th>Ø§Ù„Ù†ÙˆØ¹</th>
                        <th>Ø§Ù„Ù…Ø­ÙƒÙ…Ø©</th>
                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                </thead>
                <tbody id="sessionsTableBody">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ø¬Ù„Ø³Ø© -->
    <div id="sessionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Ø¬Ø¯ÙˆÙ„Ø© Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                <span style="cursor: pointer; font-size: 1.5rem;" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="sessionForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="case_id" class="form-label">Ø§Ù„Ù‚Ø¶ÙŠØ© *</label>
                            <select id="case_id" name="case_id" class="form-control" required>
                                <option value="">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="session_number" class="form-label">Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„Ø³Ø©</label>
                            <input type="number" id="session_number" name="session_number" class="form-control" placeholder="Ø³ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹">
                        </div>
                        <div class="form-group">
                            <label for="session_date" class="form-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¬Ù„Ø³Ø© *</label>
                            <input type="datetime-local" id="session_date" name="session_date" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="session_type" class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù„Ø³Ø© *</label>
                            <select id="session_type" name="session_type" class="form-control" required>
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹</option>
                                <option value="Ø§Ø³ØªÙ…Ø§Ø¹">Ø§Ø³ØªÙ…Ø§Ø¹</option>
                                <option value="Ù†Ø¸Ø±">Ù†Ø¸Ø±</option>
                                <option value="ØªØ­ÙƒÙŠÙ…">ØªØ­ÙƒÙŠÙ…</option>
                                <option value="Ø¥Ø«Ø¨Ø§Øª">Ø¥Ø«Ø¨Ø§Øª</option>
                                <option value="Ø­ÙƒÙ…">Ø­ÙƒÙ…</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="location" class="form-label">Ù…ÙƒØ§Ù† Ø§Ù„Ø¬Ù„Ø³Ø© *</label>
                            <input type="text" id="location" name="location" class="form-control" required placeholder="Ù…Ø«Ø§Ù„: Ù…Ø­ÙƒÙ…Ø© Ø§Ù„Ø±ÙŠØ§Ø¶ - Ù‚Ø§Ø¹Ø© 5">
                        </div>
                        <div class="form-group">
                            <label for="judge_name" class="form-label">Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ø¶ÙŠ</label>
                            <input type="text" id="judge_name" name="judge_name" class="form-control" placeholder="Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ø¶ÙŠ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„">
                        </div>
                        <div class="form-group">
                            <label for="status" class="form-label">Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ù„Ø³Ø©</label>
                            <select id="status" name="status" class="form-control">
                                <option value="Ù…Ø¬Ø¯ÙˆÙ„">Ù…Ø¬Ø¯ÙˆÙ„</option>
                                <option value="Ù…Ù†Ø¹Ù‚Ø¯">Ù…Ù†Ø¹Ù‚Ø¯</option>
                                <option value="Ù…Ù„ØºÙŠ">Ù…Ù„ØºÙŠ</option>
                                <option value="Ù…Ø¤Ø¬Ù„">Ù…Ø¤Ø¬Ù„</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="preparation_status" class="form-label">Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¶ÙŠØ±</label>
                            <select id="preparation_status" name="preparation_status" class="form-control">
                                <option value="ØºÙŠØ± Ù…Ø¹Ø¯">ØºÙŠØ± Ù…Ø¹Ø¯</option>
                                <option value="Ù‚ÙŠØ¯ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯">Ù‚ÙŠØ¯ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯</option>
                                <option value="Ù…ÙƒØªÙ…Ù„">Ù…ÙƒØªÙ…Ù„</option>
                            </select>
                        </div>
                        <div class="form-group full-width">
                            <label for="session_notes" class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø©</label>
                            <textarea id="session_notes" name="session_notes" class="form-control" rows="3" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø­ÙˆÙ„ Ø§Ù„Ø¬Ù„Ø³Ø©..."></textarea>
                        </div>
                        <div class="form-group full-width">
                            <label for="documents_required" class="form-label">Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</label>
                            <textarea id="documents_required" name="documents_required" class="form-control" rows="2" placeholder="Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„Ø¬Ù„Ø³Ø©..."></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button type="button" class="btn btn-primary" onclick="saveSession()">Ø­ÙØ¸ Ø§Ù„Ø¬Ù„Ø³Ø©</button>
            </div>
        </div>
    </div>

    <script>
        let currentEditingId = null;
        let sessions = [];

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ ØµÙØ­Ø© Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ù…Ø­Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­');
            checkAuth();
            loadSessions();
            loadCasesForFilter();
        });

        // ==================== Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ====================

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…
        async function loadSessions() {
            try {
                showLoading('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ù„Ø³Ø§Øª...');
                
                const search = document.getElementById('searchInput').value;
                const caseFilter = document.getElementById('caseFilter').value;
                const status = document.getElementById('statusFilter').value;
                const type = document.getElementById('typeFilter').value;

                let url = '/api/sessions?';
                if (search) url += `search=${encodeURIComponent(search)}&`;
                if (caseFilter) url += `case_id=${encodeURIComponent(caseFilter)}&`;
                if (status) url += `status=${encodeURIComponent(status)}&`;
                if (type) url += `session_type=${encodeURIComponent(type)}&`;

                const response = await fetch(url);
                const data = await response.json();

                if (data.success) {
                    sessions = data.data;
                    renderSessions();
                } else {
                    showError('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ù„Ø³Ø§Øª');
                }
            } catch (error) {
                console.error('Error loading sessions:', error);
                showError('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…');
            } finally {
                hideLoading();
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§ Ù„Ù„ÙÙ„Ø§ØªØ±
        async function loadCasesForFilter() {
            try {
                const response = await fetch('/api/cases/all');
                const data = await response.json();

                if (data.success && data.data) {
                    const select = document.getElementById('caseFilter');
                    select.innerHTML = '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§</option>' +
                        data.data.map(caseItem => 
                            `<option value="${caseItem.id}">${caseItem.case_number} - ${caseItem.title}</option>`
                        ).join('');
                }
            } catch (error) {
                console.error('Error loading cases for filter:', error);
            }
        }

        // ==================== Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¹Ø±Ø¶ ====================

        // Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ù„Ø³Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
        function renderSessions() {
            const tbody = document.getElementById('sessionsTableBody');
            
            if (sessions.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 3rem;">
                            <div style="color: #6c757d;">
                                <i class="fas fa-calendar-alt" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                                <h4>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø§Øª</h4>
                                <p>Ù„Ù… ÙŠØªÙ… Ø¬Ø¯ÙˆÙ„Ø© Ø£ÙŠ Ø¬Ù„Ø³Ø§Øª Ø¨Ø¹Ø¯</p>
                                <button class="btn btn-primary" onclick="openAddModal()">
                                    <i class="fas fa-plus"></i> Ø¬Ø¯ÙˆÙ„Ø© Ø£ÙˆÙ„ Ø¬Ù„Ø³Ø©
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = sessions.map(session => {
                const isUpcoming = new Date(session.session_date) > new Date() && session.status === 'Ù…Ø¬Ø¯ÙˆÙ„';
                
                return `
                <tr>
                    <td>
                        <strong>${session.session_number}</strong>
                        ${isUpcoming ? '<div class="upcoming-badge">Ù‚Ø§Ø¯Ù…Ø©</div>' : ''}
                    </td>
                    <td>
                        <div><strong>${session.case_number}</strong></div>
                        <small style="color: #666;">${session.case_title}</small>
                    </td>
                    <td>
                        <div>${formatDateTime(session.session_date)}</div>
                        <small style="color: #666;">${getTimeRemaining(session.session_date)}</small>
                    </td>
                    <td><span class="type-badge">${session.session_type}</span></td>
                    <td>${session.location || '---'}</td>
                    <td>
                        <span class="status-badge status-${getStatusClass(session.status)}">
                            ${session.status}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon btn-view" onclick="viewSession(${session.id})" title="Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-icon btn-edit" onclick="editSession(${session.id})" title="ØªØ¹Ø¯ÙŠÙ„">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon btn-delete" onclick="deleteSession(${session.id})" title="Ø­Ø°Ù">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                `;
            }).join('');
        }

        // ==================== Ø¯ÙˆØ§Ù„ Modal ====================

        // ÙØªØ­ Modal Ù…Ø¹ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§ Ø£ÙˆÙ„Ø§Ù‹
        async function openAddModal() {
            try {
                console.log('ğŸ¯ ÙØªØ­ Modal Ø¥Ø¶Ø§ÙØ© Ø¬Ù„Ø³Ø©...');
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù‚Ø¶Ø§ÙŠØ§ Ø£ÙˆÙ„Ø§Ù‹
                const checkResponse = await fetch('/api/cases/check');
                const checkData = await checkResponse.json();
                
                if (!checkData.exists) {
                    showNoCasesMessage();
                    return;
                }
                
                // Ø¥Ø°Ø§ ØªÙˆØ¬Ø¯ Ù‚Ø¶Ø§ÙŠØ§ØŒ ÙØªØ­ Modal Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ
                currentEditingId = null;
                document.getElementById('modalTitle').textContent = 'Ø¬Ø¯ÙˆÙ„Ø© Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©';
                document.getElementById('sessionForm').reset();
                
                // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
                const now = new Date();
                now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
                document.getElementById('session_date').value = now.toISOString().slice(0, 16);
                document.getElementById('status').value = 'Ù…Ø¬Ø¯ÙˆÙ„';
                document.getElementById('preparation_status').value = 'ØºÙŠØ± Ù…Ø¹Ø¯';
                document.getElementById('session_type').value = 'Ø§Ø³ØªÙ…Ø§Ø¹';
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
                await loadActiveCases();
                
                document.getElementById('sessionModal').style.display = 'block';
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ÙØªØ­ Modal:', error);
                showError('Ø®Ø·Ø£ ÙÙŠ ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ù„Ø³Ø©');
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§ Ø§Ù„Ù†Ø´Ø·Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø©
        async function loadActiveCases() {
            try {
                console.log('ğŸ”„ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§...');
                showLoading('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§...');
                
                // Ø£ÙˆÙ„Ø§Ù‹: Ø¬Ø±Ø¨ Ø¬Ù„Ø¨ Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§ Ø§Ù„Ù†Ø´Ø·Ø©
                let response = await fetch('/api/cases/active');
                let data = await response.json();
                
                const select = document.getElementById('case_id');
                
                if (data.success && data.data && data.data.length > 0) {
                    // Ø§Ù„Ø­Ø§Ù„Ø© 1: ØªÙˆØ¬Ø¯ Ù‚Ø¶Ø§ÙŠØ§ Ù†Ø´Ø·Ø©
                    console.log(`âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${data.data.length} Ù‚Ø¶ÙŠØ© Ù†Ø´Ø·Ø©`);
                    
                    select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø¶ÙŠØ©</option>' +
                        data.data.map(caseItem => 
                            `<option value="${caseItem.id}">${caseItem.case_number} - ${caseItem.title}</option>`
                        ).join('');
                        
                } else {
                    // Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ù‚Ø¶Ø§ÙŠØ§ Ù†Ø´Ø·Ø©ØŒ Ø¬Ø±Ø¨ Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§
                    console.log('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ø¶Ø§ÙŠØ§ Ù†Ø´Ø·Ø©ØŒ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§...');
                    
                    response = await fetch('/api/cases/all');
                    data = await response.json();
                    
                    if (data.success && data.data && data.data.length > 0) {
                        // Ø§Ù„Ø­Ø§Ù„Ø© 2: ØªÙˆØ¬Ø¯ Ù‚Ø¶Ø§ÙŠØ§ ÙˆÙ„ÙƒÙ†Ù‡Ø§ ØºÙŠØ± Ù†Ø´Ø·Ø©
                        console.log(`âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${data.data.length} Ù‚Ø¶ÙŠØ© (Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª)`);
                        
                        select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø¶ÙŠØ©</option>' +
                            data.data.map(caseItem => 
                                `<option value="${caseItem.id}">${caseItem.case_number} - ${caseItem.title}</option>`
                            ).join('');
                            
                        showWarning('ÙŠÙˆØ¬Ø¯ Ù‚Ø¶Ø§ÙŠØ§ ÙˆÙ„ÙƒÙ†Ù‡Ø§ Ù‚Ø¯ ØªÙƒÙˆÙ† ØºÙŠØ± Ù†Ø´Ø·Ø©. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø±Ù‡Ø§ Ù…Ø¹ Ø§Ù„Ø¹Ù„Ù… Ø¨Ø°Ù„Ùƒ.');
                            
                    } else {
                        // Ø§Ù„Ø­Ø§Ù„Ø© 3: Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ø¶Ø§ÙŠØ§ Ø¥Ø·Ù„Ø§Ù‚Ø§Ù‹
                        console.log('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ø¶Ø§ÙŠØ§ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…');
                        handleNoCases(select);
                    }
                }
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§:', error);
                handleLoadError();
            } finally {
                hideLoading();
            }
        }

        // ØªØ¹Ø¯ÙŠÙ„ Ø¬Ù„Ø³Ø©
        async function editSession(id) {
            try {
                showLoading('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø©...');
                
                const response = await fetch(`/api/sessions/${id}`);
                const data = await response.json();

                if (data.success) {
                    currentEditingId = id;
                    document.getElementById('modalTitle').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ù„Ø³Ø©';
                    
                    // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                    const sessionData = data.data;
                    document.getElementById('case_id').value = sessionData.case_id;
                    document.getElementById('session_number').value = sessionData.session_number;
                    
                    // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù„Ù„Ù€ datetime-local
                    const sessionDate = new Date(sessionData.session_date);
                    sessionDate.setMinutes(sessionDate.getMinutes() - sessionDate.getTimezoneOffset());
                    document.getElementById('session_date').value = sessionDate.toISOString().slice(0, 16);
                    
                    document.getElementById('session_type').value = sessionData.session_type;
                    document.getElementById('location').value = sessionData.location || '';
                    document.getElementById('judge_name').value = sessionData.judge_name || '';
                    document.getElementById('status').value = sessionData.status;
                    document.getElementById('preparation_status').value = sessionData.preparation_status;
                    document.getElementById('session_notes').value = sessionData.session_notes || '';
                    document.getElementById('documents_required').value = sessionData.documents_required || '';
                    
                    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§ Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„Ù‚Ø¶ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                    await loadActiveCases();
                    
                    document.getElementById('sessionModal').style.display = 'block';
                } else {
                    showError('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø©');
                }
            } catch (error) {
                showError('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø©');
            } finally {
                hideLoading();
            }
        }

        // Ø­ÙØ¸ Ø§Ù„Ø¬Ù„Ø³Ø© (Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„)
        async function saveSession() {
            const formData = new FormData(document.getElementById('sessionForm'));
            const sessionData = Object.fromEntries(formData);

            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            Object.keys(sessionData).forEach(key => {
                if (sessionData[key] === '') delete sessionData[key];
            });

            if (!sessionData.case_id || !sessionData.session_date) {
                showError('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù‚Ø¶ÙŠØ© ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„Ø¬Ù„Ø³Ø©');
                return;
            }

            try {
                showLoading('Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„Ø¬Ù„Ø³Ø©...');
                
                const url = currentEditingId ? `/api/sessions/${currentEditingId}` : '/api/sessions';
                const method = currentEditingId ? 'PUT' : 'POST';

                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(sessionData)
                });

                const data = await response.json();

                if (data.success) {
                    showSuccess(data.message);
                    closeModal();
                    loadSessions();
                } else {
                    showError(data.message);
                }
            } catch (error) {
                showError('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¬Ù„Ø³Ø©');
            } finally {
                hideLoading();
            }
        }

        // ==================== Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ====================

        // Ø­Ø°Ù Ø¬Ù„Ø³Ø©
        async function deleteSession(id) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¬Ù„Ø³Ø©ØŸ')) {
                return;
            }

            try {
                showLoading('Ø¬Ø§Ø±ÙŠ Ø­Ø°Ù Ø§Ù„Ø¬Ù„Ø³Ø©...');
                
                const response = await fetch(`/api/sessions/${id}`, {
                    method: 'DELETE'
                });

                const data = await response.json();

                if (data.success) {
                    showSuccess(data.message);
                    loadSessions();
                } else {
                    showError(data.message);
                }
            } catch (error) {
                showError('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¬Ù„Ø³Ø©');
            } finally {
                hideLoading();
            }
        }

        // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¬Ù„Ø³Ø©
        function viewSession(id) {
            const session = sessions.find(s => s.id === id);
            if (session) {
                const details = `
ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¬Ù„Ø³Ø©:

Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„Ø³Ø©: ${session.session_number}
Ø§Ù„Ù‚Ø¶ÙŠØ©: ${session.case_number} - ${session.case_title}
Ø§Ù„ØªØ§Ø±ÙŠØ®: ${formatDateTime(session.session_date)}
Ø§Ù„Ù†ÙˆØ¹: ${session.session_type}
Ø§Ù„Ù…ÙƒØ§Ù†: ${session.location || '---'}
Ø§Ù„Ù‚Ø§Ø¶ÙŠ: ${session.judge_name || '---'}
Ø§Ù„Ø­Ø§Ù„Ø©: ${session.status}
Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¶ÙŠØ±: ${session.preparation_status}
${session.session_notes ? `Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${session.session_notes}` : ''}
                `.trim();
                
                alert(details);
            }
        }

        // Ø¥ØºÙ„Ø§Ù‚ Modal
        function closeModal() {
            document.getElementById('sessionModal').style.display = 'none';
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© ÙÙ‚Ø·
        function showUpcomingOnly() {
            document.getElementById('statusFilter').value = 'Ù…Ø¬Ø¯ÙˆÙ„';
            loadSessions();
        }

        // ==================== Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© ====================

        // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù‚Ø¶Ø§ÙŠØ§
        function handleNoCases(select) {
            select.innerHTML = `
                <option value="">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ø¶Ø§ÙŠØ§ Ù…ØªØ§Ø­Ø©</option>
            `;
            
            // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© ØªÙˆØ¬ÙŠÙ‡ÙŠØ©
            const messageDiv = document.createElement('div');
            messageDiv.className = 'alert alert-warning';
            messageDiv.style.marginTop = '1rem';
            messageDiv.innerHTML = `
                <div style="text-align: center; padding: 1rem;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                    <h4>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ø¶Ø§ÙŠØ§</h4>
                    <p>Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ù‚Ø¶Ø§ÙŠØ§ Ø¨Ø¹Ø¯. ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ù‚Ø¶ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹ Ù…Ù† ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§.</p>
                    <button class="btn btn-primary" onclick="goToCasesPage()">
                        <i class="fas fa-gavel"></i> Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§
                    </button>
                </div>
            `;
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø¹Ø¯ Ø­Ù‚Ù„ Ø§Ù„Ù‚Ø¶ÙŠØ©
            const caseField = document.getElementById('case_id').parentNode;
            caseField.parentNode.insertBefore(messageDiv, caseField.nextSibling);
        }

        // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        function handleLoadError() {
            const select = document.getElementById('case_id');
            select.innerHTML = `
                <option value="">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§</option>
            `;
            
            showError('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§. ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø®Ø§Ø¯Ù….');
        }

        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø¹Ù†Ø¯Ù…Ø§ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ø¶Ø§ÙŠØ§
        function showNoCasesMessage() {
            const message = `
                <div style="text-align: center; padding: 2rem;">
                    <i class="fas fa-gavel" style="font-size: 4rem; color: #6c757d; margin-bottom: 1rem;"></i>
                    <h3 style="color: #6c757d;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ø¶Ø§ÙŠØ§</h3>
                    <p style="color: #6c757d; margin-bottom: 2rem;">ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© Ù‚Ø¶ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹ Ù‚Ø¨Ù„ Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ø¬Ù„Ø³Ø§Øª</p>
                    <div style="display: flex; gap: 1rem; justify-content: center;">
                        <button class="btn btn-primary btn-lg" onclick="goToCasesPage()">
                            <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù‚Ø¶ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©
                        </button>
                        <button class="btn btn-secondary btn-lg" onclick="location.reload()">
                            <i class="fas fa-redo"></i> Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„
                        </button>
                    </div>
                </div>
            `;
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙÙŠ Ù…ÙƒØ§Ù† Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¬Ù„Ø³Ø§Øª
            const tableContainer = document.querySelector('.sessions-table');
            tableContainer.innerHTML = message;
        }

        // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§
        function goToCasesPage() {
            window.location.href = '/cases';
        }

        // Ø¥Ø¸Ù‡Ø§Ø± ØªØ­Ø°ÙŠØ±
        function showWarning(message) {
            const warningDiv = document.createElement('div');
            warningDiv.className = 'alert alert-warning';
            warningDiv.style.marginTop = '0.5rem';
            warningDiv.style.padding = '0.5rem';
            warningDiv.innerHTML = `
                <i class="fas fa-exclamation-circle"></i> ${message}
            `;
            
            const caseField = document.getElementById('case_id').parentNode;
            caseField.appendChild(warningDiv);
        }

        // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
        function showLoading(message = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...') {
            document.getElementById('loadingText').textContent = message;
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        function showSuccess(message) {
            alert('âœ… ' + message);
        }

        function showError(message) {
            alert('âŒ ' + message);
        }

        // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚
        function getStatusClass(status) {
            const statusMap = {
                'Ù…Ø¬Ø¯ÙˆÙ„': 'scheduled',
                'Ù…Ù†Ø¹Ù‚Ø¯': 'held',
                'Ù…Ù„ØºÙŠ': 'cancelled',
                'Ù…Ø¤Ø¬Ù„': 'postponed'
            };
            return statusMap[status] || 'scheduled';
        }

        function formatDateTime(dateString) {
            if (!dateString) return '---';
            return new Date(dateString).toLocaleString('ar-SA', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function getTimeRemaining(dateString) {
            if (!dateString) return '';
            
            const now = new Date();
            const sessionDate = new Date(dateString);
            const diffTime = sessionDate - now;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays > 0) {
                return `Ø¨Ø¹Ø¯ ${diffDays} ÙŠÙˆÙ…`;
            } else if (diffDays === 0) {
                return 'Ø§Ù„ÙŠÙˆÙ…';
            } else {
                return 'Ù…Ù†ØªÙ‡ÙŠØ©';
            }
        }

        // ==================== Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ====================

        async function logout() {
            try {
                await fetch('/api/auth/logout', { method: 'POST' });
                window.location.href = '/login';
            } catch (error) {
                window.location.href = '/login';
            }
        }

        async function checkAuth() {
            try {
                const response = await fetch('/api/auth/status');
                const data = await response.json();
                
                if (!data.authenticated) {
                    window.location.href = '/login';
                }
            } catch (error) {
                window.location.href = '/login';
            }
        }

        // Ø¥ØºÙ„Ø§Ù‚ Modal Ø¨Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
        window.onclick = function(event) {
            const modal = document.getElementById('sessionModal');
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>